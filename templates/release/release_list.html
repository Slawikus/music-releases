{% extends 'base.html' %}

{% block title %}{{ title }}{% endblock title %}

{% block content %}

  {% url 'my_releases' as my_releases %}
  {% if request.path == my_releases %}
      <a class="btn btn-outline-success" href="{% url 'import_releases' %}">Import</a>
  {% endif %}

  {% for release in releases %}

    <div class="p-2 shadow-4 rounded-3 mt-1" style="background-color: #283046">
      <div class="row">
        <div class="col-2">
          {% if release.cover_image %}
            <img src="{{ release.cover_image.url }}" alt="" srcset="" class="img-thumbnail">
          {% endif %}
        </div>
        <div class="col-4">
          <p>{{ release.band_name }} ({{ release.country }})</p>
          <p>{{ release.album_title }} - {{ release.format }} | {{ release.divide_media_format }}</p>
          <p>{{ release.base_style }}</p>
          <p>{{ release.submitted_at|date:"d.m.Y" }}
              {% if release.label %}
                <a href="{% url 'label_detail' release.label.pk %}">
                    {{ release.label.name }}({{ release.label.profile.country }})
                </a>
              {% endif %}
        </div>
        <div class="col-4">

          <p>
            Trade points:
            {% if release.releasetradesinfo.trade_points is None %}
              -
            {% else %}
              {{ release.releasetradesinfo.trade_points }}
            {% endif %}
          </p>
          <p>Wholesale prices: </p>
            {% for price in release.release_price.all %}
              <p>{{ price.price }} {{ price.currency }}</p>
            {% endfor %}
          <p>
              {% if release.marketinginfos.youtube_url %}
                  <a href="release.marketinginfos.youtube_url">
                    <i data-feather="youtube"></i>
                  </a>
              {% endif %}
              {% if release.marketinginfos.soundcloud_url %}
                  <a href="release.marketinginfos.soundcloud_url">
                    <i data-feather="cloud"></i>
                  </a>
              {% endif %}
          </p>

        </div>

        <div class="col-2">
          {% if not release.is_submitted %}
            <form action="{% url 'release_submit' release.pk %}" method="post">
              {% csrf_token %}
              <button type="submit" class="btn btn-primary">Submit</button>
            </form>
          {% endif %}
          {% if request.path == my_releases %}
            <a href="{% url 'edit_release' release.pk %}" class="btn btn-outline-primary">Edit</a>
          {% else %}
            <a href="{% url 'postman:write' release.profile.user.email %}" class="btn btn-success">Contact label</a>
          {% endif %}
          {% if release.profile != user.profile %}
            <a href="{% url 'create_trade_request' release.profile.id %}" class="btn btn-primary">View tradelist</a>
          {% endif %}
          <a class="btn btn-gradient-info" data-bs-toggle="collapse" href="#collapse-info-{{ release.id }}" role="button" aria-expanded="false" aria-controls="collapseExample">
            info
          </a>
        </div>
          <div class="collapse" id="collapse-info-{{ release.id }}">
              <div class="card card-body">
                <div class="row">
                    <div class="col-5">
                        <strong>Overview: </strong>
                        <p>{{ release.marketinginfos.release_overview|default_if_none:"-" }}</p>
                    </div>
                    <div class="col-5">
                        <strong>press feedback: </strong>
                        <p>{{ release.marketinginfos.press_feedback|default_if_none:"-" }}</p>
                    </div>
                </div>
             </div>
          </div>
          {% if release.sample %}
            <audio controls="controls">
              <source src="{{ release.sample.url }}" type="audio/mpeg" />
            </audio>
            {% endif %}

    </div>
    </div>

  {% endfor %}
  </div>
{% endblock content %}
