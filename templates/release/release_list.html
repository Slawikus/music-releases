{% extends 'base.html' %}

{% block title %}{{ title }}{% endblock title %}

{% block content %}
  {% url 'my_releases' as my_releases %}
  {% if request.path == my_releases %}
      <a class="btn btn-secondary" href="{% url 'import_releases' %}">Import</a>
  {% endif %}

  {% for release in releases %}

    <div class="p-4 shadow-4 rounded-3 mt-3" style="background-color: hsl(0, 0%, 94%);">
      <div class="row">
        <div class="col-2">
          <img src="{{ release.cover_image.url }}" alt="" srcset="" class="img-thumbnail">
        </div>
        <div class="col-4">
          <p>{{ release.band_name }} ({{ release.country }})</p>
          <p>{{ release.album_title }} - {{ release.format }} | {{ release.divide_media_format }}</p>
          <p>{{ release.base_style }}</p>
          <p>{{ release.submitted_at|date:"d.m.Y" }} <a href="{% url 'label_detail'  release.label.pk %}">{{ release.label.name }}</a>
              ({{ release.label.profile.country }})</p>
        </div>
        <div class="col-4">

          <p>
            Trade points:
            {% if release.releasetradesinfo.trade_points is None %}
              -
            {% else %}
              {{ release.releasetradesinfo.trade_points }}
            {% endif %}
          </p>
          <p>Wholesale prices: </p>
            {% for price in release.release_price.all %}
              <p>{{ price.price }} {{ price.currency }}</p>
            {% endfor %}

        </div>

        <div class="col-2">
          {% if not release.is_submitted %}
            <form action="{% url 'release_submit' release.pk %}" method="post">
              {% csrf_token %}
              <button type="submit" class="btn btn-primary">Submit</button>
            </form>
          {% endif %}
          {% if request.path == my_releases %}
            <a href="{% url 'edit_release' release.pk %}" class="btn btn-secondary mt-3">Edit</a>
          {% else %}
            <a href="{% url 'postman:write' release.profile.user.email %}" class="btn btn-success">Contact label</a>
          {% endif %}
        </div>

    </div>
    <audio controls="controls">
      <source src="{{ release.sample.url }}" type="audio/mpeg" />
    </audio>


  </div>
  {% endfor %}
  <div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">&laquo; first</a>
            <a href="?page={{ page_obj.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
        {% endif %}
    </span>
</div>
{% endblock content %}
