{% load static %}

{% load crispy_forms_tags %}

<!DOCTYPE html>
<html class="loading dark-layout" lang="en" data-layout="dark-layout" data-textdirection="ltr">
<!-- BEGIN: Head-->
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0,minimal-ui">
  <title>{% block title %}Tradelist{% endblock title %}</title>
  {#    <link rel="apple-touch-icon" href="../../../app-assets/images/ico/apple-icon-120.png">#}
  {#    <link rel="shortcut icon" type="image/x-icon" href="../../../app-assets/images/ico/favicon.ico">#}
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;1,400;1,500;1,600"
        rel="stylesheet">
  <!-- BEGIN: CSS-->
  {% include 'styles/vendor-css.html' %}
  {% include 'styles/theme-css.html' %}
  {% include 'styles/page-css.html' %}
  <link rel="stylesheet" type="text/css"
        href="{% static 'app-assets/css/plugins/extensions/ext-component-media-player.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
  <!-- END: CSS-->
</head>
<body>
<div class="container-sm container-fluid">
  <h3 class="mb-4 mt-3 text-center">Tradelist</h3>
  <div class="row mt-3 mb-3">
    <div class="col-sm-4 col-12">
      <form method="post">
        {% csrf_token %}
        {{ form|crispy }}
      </form>
      <button onclick="fill_data()" id="submit" class="btn btn-primary ml-4 w-10">Send</button>
    </div>

    <div class="p-4 shadow-4 rounded-3 mt-3" style="background-color: hsl(0, 0%, 94%);">
      <div class="row">
        <table class="table">
          <thead class="thead-dark">
          <tr>
            <th scope="col">quantity</th>
            <th scope="col">band name</th>
            <th scope="col">trade points</th>
            <th scope="col">wholesale price</th>
            <th scope="col">album</th>
            <th scope="col">format</th>
          </tr>
          </thead>
          <tbody>
          {% for release in releases %}
            <tr>
              <td><input type="number" class="quantity" release_id="{{ release.id }}"></td>
              <td>{{ release.band_name }} ({{ release.country }})</td>
              <td>{{ release.wholesaleandtrades.trade_points }}</td>
              <td>
                {% for wholesale_price in release.wholesale_prices.all %}
                  {{ wholesale_price.price }} - {{ wholesale_price.currency }},
                {% endfor %}
              </td>
              <td>{{ release.album_title }}</td>
              <td>{{ release.format }}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>
<!-- BEGIN: JS-->
{% include 'scripts/vendor-js.html' %}
{% include 'scripts/theme-js.html' %}
{% block extra_javascript %}
  <script>
      let data = $("#id_items");

      function fill_data() {
          data.val(null);
          let quantities = $("body .quantity");
          for (let i = 0; i < quantities.length; i++) {
              if (quantities[i].value > 0) {
                  data.val(data.val() + quantities[i].getAttribute("release_id") + ":" + quantities[i].value + ",");
              }
          }
          // delete last comma
          data.val(data.val().slice(0, -1));
          $("form").submit();
      }
  </script>
{% endblock extra_javascript %}
{% block inline_javascript %}
  <script>
      $(window).on('load', function () {
          if (feather) {
              feather.replace({
                  width: 14,
                  height: 14
              });
          }
      })
  </script>
{% endblock inline_javascript %}
<!-- END: JS-->
</body>
<!-- END: Body-->
</html>
